{
    "collab_server" : "",
    "contents" : "#' get a company's market cap, data comes from NetEase\n#'\n#' @param indexPool a pool of different index, special format for gfer\n#' @importFrom data.table rbindlist\n#' @return A data table with companies total capitalization and market capitalization\n#'\n#'\n\ngetIndexConstnt <- function(indexPool) {\n  for (i in 1:nrow(indexPool)) {\n    url <- as.character(indexPool[i, 2])\n    # index information comes from 2 different source by now, so it needs to\n    # detect wether it's from sina or etnet\n    if (grepl('sina.com', url)) {\n      listNum <- 4\n    } else if (grepl('etnet.com', url)){\n      listNum <- 1\n    } else break ('Wrong url in indexPool')\n\n    data <- html_table(read_html(url), fill = TRUE)[[listNum]][, 1:2]\n    data <- data[2:nrow(data), ]\n    data[,3] <- rep(indexPool[i,1], nrow(data))\n    colnames(data) <- c('ticker', 'name', 'index')\n    rownames(data) <- NULL\n\n    if (i == 1) {\n      tData <- data\n    } else {\n      tData <- rbindlist(list(tData, data))\n    }\n  }\n\n  return(tData)\n}\n\n\n#' get a company's market cap, data comes from NetEase\n#'\n#' @param tickers ticker/sympol of a company\n#' @importFrom data.table data.table :=\n#' @return A data table with companies and which index they are included\n#' @examples\n#' \\dontrun{\n#' getIndex(600601)\n#' }\n#'\n#'\n\n\ngetIndex <-function(tickers) {\n\n  #creat an index pool\n  indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',\n                                    'HSI', 'HSCEI'),\n                          url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',\n                                  'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',\n                                  'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',\n                                  'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',\n                                  'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',\n                                  'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'\n                          )\n  )\n\n  data <- getIndexConstnt(indexPool)\n\n  indexTable <- data.table(tickers)\n\n  emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))\n\n  indexTable[, c(as.character(indexPool$index)) := emptyCols]\n\n  for (i in tickers) {\n\n  }\n\n}\n",
    "created" : 1489073482962.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "932393278",
    "id" : "D9F3BB1F",
    "lastKnownWriteTime" : 1489249194,
    "last_content_update" : 1489250510645,
    "path" : "~/GitHub/gfer/R/getIndex.R",
    "project_path" : "R/getIndex.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 0,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}