{
    "collab_server" : "",
    "contents" : "\n\n#' plotWaternomics\n#'\n#' plot special waternomics chart for CWR\n#'\n#'\n#' @param data a dataframe containing columns of GDP, Value-added of fisrt/second/third industry, x and y\n#' x and y are the coordinates of the plot, and it varies depending on needs, can be per capita\n#' water use vs. per capita wastewater, etc. See example of year 2015 by \\code{GDPmix}\n#'\n#' Columns should be exactly the same as GDPmix, which means, first column is province, seconnd is x,\n#' third is y, fourth is Frist, etc. Load GDPmix to have a look at the columns.\n#' @param title chart title\n#' @param xname x axis name\n#' @param yname y axis name\n#' @param small radius of small circle, default is 1.5\n#' @param medium radius of medium circle, default is 3\n#' @param large radius of large circle, default is 5\n#' @param legend whether to show legend, default is TRUE\n#' @param label whether to show label, default is TRUE\n#' @param xmean a line showing mean value of x\n#' @param ymean a line showing mean value of y\n#' @param line whether to show ablines, default is TRUE\n#' @importFrom mapplots add.pie\n#' @importFrom graphics plot plot.new\n#' @importFrom grDevices rgb\n#' @importFrom plotrix thigmophobe.labels\n#' @export\n#' @examples\n#' \\dontrun{\n#' data(GDPmix)\n#' plotwaternomics(GDPmix)\n#' }\n\n\n\nplotWaternomics <- function(data, title = '', xname = '', yname = '', small = 1.5, medium = 3, large = 5,\n                            legend = TRUE, label = TRUE, xmean = NULL, ymean = NULL, line = TRUE) {\n  # plot basic plot based on x and y\n  #plot.new()\n\n  # for some buffer space, extend the x and y axis, redefine them first\n  xlim <- getLim(data$x)\n\n  ylim <- getLim(data$y)\n\n\n  plot(data$x, data$y, main = title, xlab = xname, ylab = yname,\n       xlim = xlim, ylim = ylim,\n       bty = 'n')\n\n\n\n  provinceNum <- nrow(data)\n\n  # decide radius of the pie charts\n  r <- getRadius(data$GDP, small, medium, large)\n\n  # define CWR color\n  col <- c(rgb(107/255, 128/255, 51/255), rgb(2/255, 3/255, 3/255), rgb(13/255, 119/255, 185/255))\n\n\n\n\n  # add pie charts\n  for (i in 1:provinceNum) {\n\n    add.pie(x = data$x[i], y = data$y[i], z = c(data$First[i], data$Second[i], data$Third[i]),\n            labels = '', radius = r[i], col = col, border = \"white\")\n    #thigmophobe.labels(data$x[i], data$y[i], data$Province[i], offset = r[i]/3)\n\n  }\n  if (legend == TRUE) {\n    legend('topright', c(\"Agriculture\",\"Industry\",\"Services\"), cex = 0.8,\n           fill = col)\n  }\n  if (label == TRUE) {\n    thigmophobe.labels(data$x, data$y, data$Province, offset = 1)\n  }\n\n\n  if (line == TRUE) {\n    # add ablines of national mean or mean\n    if (is.null(xmean)) xmean <- round(mean(data$x), 2)\n    if (is.null(ymean)) ymean <- round(mean(data$y), 2)\n    abline(h = ymean, v = xmean, col = '#c00000', lwd = 3, lty = 2)\n  }\n\n  #spread.labels(data$x, data$y, data$Province, offsets = 0.01)\n\n}\n\n\n\n#' plotWaternomics_legend\n#'\n#' legend for plot special waternomics chart for CWR\n#'\n#' @param label whether to show label, default is TRUE\n#' @importFrom mapplots add.pie\n#' @importFrom graphics plot abline text\n#' @importFrom grDevices rgb\n#' @export\n#' @examples\n#' \\dontrun{\n#' plotwaternomics_legend()\n#' }\nplotWaternomics_legend <- function(label = TRUE) {\n  r <- c(5, 3, 1.5)\n  x <- c(0, 0, 0)\n  y <- c(7, 16, 21)\n  plot (x, y, xlim = c(-3, 3), ylim = c(0, 23), xaxt = 'n', yaxt = 'n', bty = 'n')\n\n  col <- c(rgb(107/255, 128/255, 51/255), rgb(2/255, 3/255, 3/255), rgb(13/255, 119/255, 185/255))\n\n  for (i in 1:3) {\n    add.pie(x = x[i], y = y[i], z = c(1, 1, 1), radius = r[i], labels = '', col = col, border = 'white')\n  }\n  if (label == TRUE) {\n    size <- 1.2\n    text(-0.7, 8.5, \"Service\", col = 'white', cex = size)\n    text(0.7, 8.5, \"Agriculture\", col = 'white', cex = size)\n    text(0, 4, \"Industry\", col = 'white', cex = size)\n  }\n}\n\n\n\n\n\ngetLim <- function(x) {\n  # decide axis interval\n  dig <- nchar(min(round(x)))\n\n  x1 <- round(min(x) - (max(x) - min(x))/length(x), -(dig - 1))\n  x2 <- round(max(x) + (max(x) - min(x))/length(x), -(dig - 1))\n\n  return(c(x1, x2))\n}\n\n\n\n\n\n# this is for setting plot radius\ngetRadius <- function(y, small = 1.5, medium = 3, large = 5) {\n  r <- sapply(y, function(x) {\n    if (x <= 40000 & x >= 15000) {\n      x <- medium\n    } else if (x < 15000) {\n      x <- small\n    } else {\n      x <- large\n    }\n  })\n  return (r)\n}\n\n",
    "created" : 1501146295542.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "186311523",
    "id" : "2B6F6B05",
    "lastKnownWriteTime" : 1501230050,
    "last_content_update" : 1501230050058,
    "path" : "~/GitHub/gfer/R/plotWaternomics.R",
    "project_path" : "R/plotWaternomics.R",
    "properties" : {
    },
    "relative_order" : 14,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}