write.table(b, file, fileEncoding = 'UTF-8', sep = ',')
?write.table
b
a <- read.table('clipboard')
a
a <- read.table('clipboard', colClasses = 'character')
a
c <- getIndex(a)
c
debug(getIndex)
c <- getIndex(a)
i
subData
indexArray
indexArray
RES
res
indexArray
rbind(res, indexArray, row.names = FALSE)
?rbind
#' get a company's market cap, data comes from NetEase
#'
#' @param indexPool a pool of different index, special format for gfer
#' @importFrom data.table rbindlist
#' @return A data table with companies total capitalization and market capitalization
#'
#'
getIndexConstnt <- function(indexPool) {
for (i in 1:nrow(indexPool)) {
url <- as.character(indexPool[i, 2])
# index information comes from 2 different source by now, so it needs to
# detect wether it's from sina or etnet
if (grepl('sina.com', url)) {
listNum <- 4
} else if (grepl('etnet.com', url)){
listNum <- 1
} else break ('Wrong url in indexPool')
data <- html_table(read_html(url), fill = TRUE)[[listNum]][, 1:2]
data <- data[2:nrow(data), ]
data[,3] <- rep(indexPool[i,1], nrow(data))
colnames(data) <- c('ticker', 'name', 'index')
rownames(data) <- NULL
if (i == 1) {
tData <- data
} else {
tData <- rbindlist(list(tData, data))
}
}
return(tData)
}
#' get a company's market cap, data comes from NetEase
#'
#' @param tickers ticker/sympol of a company
#' @importFrom data.table data.table :=
#' @return A data table with companies and which index they are included
#' @examples
#' \dontrun{
#' getIndex(600601)
#' }
#'
#'
getIndex <-function(tickers) {
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
data <- getIndexConstnt(indexPool)
#indexTable <- data.table(tickers)
#emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))
#indexTable[, c(as.character(indexPool$index)) := emptyCols]
if (!(is.data.frame(tickers)|is.numeric(tickers)|is.character(tickers))) warning('Your input better be a data.frame...')
n <- 1
for (i in tickers[[1]]) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
subData <- with(data, {
data[ticker == i]
})
indexArray[as.character(subData$index)] <- 1
indexArray[1] <- i
#######################
if (n == 1) {
res <- indexArray
} else {
# since indexArray is not a dataframe, use rbind instead of rbindlist
res <- rbind(res, indexArray)
}
n <- n + 1
}
rownames(res) <- NULL
return(res)
}
c <- getIndex(a)
c
a
a <- read.table('clipboard', colClasses = 'character')
a
c <- getIndex(a)
c
write.table(c, file, fileEncoding = 'UTF-8', sep = ',')
getIndex(00886)
c <- getIndex(a)
debug(getIndex)
c <- getIndex(a)
data
data[index == 'HSI']
i
b
write.table(b, file, fileEncoding = 'UTF-8', sep = ',')
write.table(b, file, fileEncoding = 'UTF-8', sep = ',', row.names = F)
write.table(c, file, fileEncoding = 'UTF-8', sep = ',', row.names = F)
a <- read.table('clipboard', colClasses = 'character')
a
write.table(b, file, fileEncoding = 'UTF-8', sep = ',')
b <- getTickers(a)
write.table(b, file, fileEncoding = 'UTF-8', sep = ',')
write.table(b, file, fileEncoding = 'UTF-8', sep = ',', row.names = F)
a <- read.table('clipboard', colClasses = 'character')
c <- getIndex(a)
undebug(getIndex)
c <- getIndex(a)
#' get a company's market cap, data comes from NetEase
#'
#' @param indexPool a pool of different index, special format for gfer
#' @importFrom data.table rbindlist
#' @return A data table with companies total capitalization and market capitalization
#'
#'
getIndexConstnt <- function(indexPool) {
for (i in 1:nrow(indexPool)) {
url <- as.character(indexPool[i, 2])
# index information comes from 2 different source by now, so it needs to
# detect wether it's from sina or etnet
if (grepl('sina.com', url)) {
listNum <- 4
} else if (grepl('etnet.com', url)){
listNum <- 1
} else break ('Wrong url in indexPool')
data <- html_table(read_html(url), fill = TRUE)[[listNum]][, 1:2]
data <- data[2:nrow(data), ]
data[,3] <- rep(indexPool[i,1], nrow(data))
colnames(data) <- c('ticker', 'name', 'index')
rownames(data) <- NULL
if (i == 1) {
tData <- data
} else {
tData <- rbindlist(list(tData, data))
}
}
return(tData)
}
#' get a company's market cap, data comes from NetEase
#'
#' @param tickers ticker/sympol of a company
#' @importFrom data.table data.table :=
#' @return A data table with companies and which index they are included
#' @examples
#' \dontrun{
#' getIndex(600601)
#' }
#'
#'
getIndex <-function(tickers) {
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
data <- getIndexConstnt(indexPool)
#indexTable <- data.table(tickers)
#emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))
#indexTable[, c(as.character(indexPool$index)) := emptyCols]
if (!(is.data.frame(tickers)|is.numeric(tickers)|is.character(tickers))) warning('Your input better be a data.frame...')
n <- 1
for (i in tickers[[1]]) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
subData <- with(data, {
data[ticker == i]
})
indexArray[as.character(subData$index)] <- 1
indexArray[1] <- i
#######################
if (n == 1) {
res <- indexArray
} else {
# since indexArray is not a dataframe, use rbind instead of rbindlist
res <- rbind(res, indexArray)
}
message(n)
n <- n + 1
}
rownames(res) <- NULL
return(res)
}
c <- getIndex(a)
c
write.table(c, file, fileEncoding = 'UTF-8', sep = ',', row.names = F)
a <- read.table('clipboard', colClasses = 'character')
c <- getIndex(a)
write.table(c, file, fileEncoding = 'UTF-8', sep = ',', row.names = F)
getIndex(600027)
getIndex(002202)
getIndex('002202')
#' get a company's market cap, data comes from NetEase
#'
#' @param indexPool a pool of different index, special format for gfer
#' @importFrom data.table rbindlist
#' @return A data table with companies total capitalization and market capitalization
#'
#'
getIndexConstnt <- function(indexPool) {
for (i in 1:nrow(indexPool)) {
url <- as.character(indexPool[i, 2])
# index information comes from 2 different source by now, so it needs to
# detect wether it's from sina or etnet
if (grepl('sina.com', url)) {
listNum <- 4
} else if (grepl('etnet.com', url)){
listNum <- 1
} else break ('Wrong url in indexPool')
data <- html_table(read_html(url), fill = TRUE)[[listNum]][, 1:2]
data <- data[2:nrow(data), ]
data[,3] <- rep(indexPool[i,1], nrow(data))
colnames(data) <- c('ticker', 'name', 'index')
rownames(data) <- NULL
if (i == 1) {
tData <- data
} else {
tData <- rbindlist(list(tData, data))
}
}
return(tData)
}
#' get a company's market cap, data comes from NetEase
#'
#' @param tickers ticker/sympol of a company
#' @importFrom data.table data.table :=
#' @return A data table with companies and which index they are included
#' @examples
#' \dontrun{
#' getIndex(600601)
#' }
#'
#'
getIndex <-function(tickers, indexData) {
if (!(is.data.frame(tickers)|is.numeric(tickers)|is.character(tickers))) warning('Your input better be a data.frame...')
n <- 1
for (i in tickers[[1]]) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
subData <- with(indexData, {
indexData[ticker == i]
})
indexArray[as.character(subData$index)] <- 1
indexArray[1] <- i
#######################
if (n == 1) {
res <- indexArray
} else {
# since indexArray is not a dataframe, use rbind instead of rbindlist
res <- rbind(res, indexArray)
}
message(n)
n <- n + 1
}
rownames(res) <- NULL
return(res)
}
getIndexData <- function(){
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
indexData <- getIndexConstnt(indexPool)
return(indexData)
}
indexData <- getIndexData()
getIndex('002202', indexData)
str(indexData)
indexData
unique(indexData$index)
as.character(unique(indexData$index))
#' get a company's market cap, data comes from NetEase
#'
#' @param indexPool a pool of different index, special format for gfer
#' @importFrom data.table rbindlist
#' @return A data table with companies total capitalization and market capitalization
#'
#'
getIndexConstnt <- function(indexPool) {
for (i in 1:nrow(indexPool)) {
url <- as.character(indexPool[i, 2])
# index information comes from 2 different source by now, so it needs to
# detect wether it's from sina or etnet
if (grepl('sina.com', url)) {
listNum <- 4
} else if (grepl('etnet.com', url)){
listNum <- 1
} else break ('Wrong url in indexPool')
data <- html_table(read_html(url), fill = TRUE)[[listNum]][, 1:2]
data <- data[2:nrow(data), ]
data[,3] <- rep(indexPool[i,1], nrow(data))
colnames(data) <- c('ticker', 'name', 'index')
rownames(data) <- NULL
if (i == 1) {
tData <- data
} else {
tData <- rbindlist(list(tData, data))
}
}
return(tData)
}
#' get a company's market cap, data comes from NetEase
#'
#' @param tickers ticker/sympol of a company
#' @importFrom data.table data.table :=
#' @return A data table with companies and which index they are included
#' @examples
#' \dontrun{
#' getIndex(600601)
#' }
#'
#'
getIndex <-function(tickers, indexData) {
if (!(is.data.frame(tickers)|is.numeric(tickers)|is.character(tickers))) warning('Your input better be a data.frame...')
n <- 1
for (i in tickers[[1]]) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(unique(indexData$index)))
subData <- with(indexData, {
indexData[ticker == i]
})
indexArray[as.character(subData$index)] <- 1
indexArray[1] <- i
#######################
if (n == 1) {
res <- indexArray
} else {
# since indexArray is not a dataframe, use rbind instead of rbindlist
res <- rbind(res, indexArray)
}
message(n)
n <- n + 1
}
rownames(res) <- NULL
return(res)
}
getIndexData <- function(){
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
indexData <- getIndexConstnt(indexPool)
return(indexData)
}
getIndex('002202', indexData)
unique(indexData$index)
length(unique(indexData$index))
#' get a company's market cap, data comes from NetEase
#'
#' @param indexPool a pool of different index, special format for gfer
#' @importFrom data.table rbindlist
#' @return A data table with companies total capitalization and market capitalization
#'
#'
getIndexConstnt <- function(indexPool) {
for (i in 1:nrow(indexPool)) {
url <- as.character(indexPool[i, 2])
# index information comes from 2 different source by now, so it needs to
# detect wether it's from sina or etnet
if (grepl('sina.com', url)) {
listNum <- 4
} else if (grepl('etnet.com', url)){
listNum <- 1
} else break ('Wrong url in indexPool')
data <- html_table(read_html(url), fill = TRUE)[[listNum]][, 1:2]
data <- data[2:nrow(data), ]
data[,3] <- rep(indexPool[i,1], nrow(data))
colnames(data) <- c('ticker', 'name', 'index')
rownames(data) <- NULL
if (i == 1) {
tData <- data
} else {
tData <- rbindlist(list(tData, data))
}
}
return(tData)
}
#' get a company's market cap, data comes from NetEase
#'
#' @param tickers ticker/sympol of a company
#' @importFrom data.table data.table :=
#' @return A data table with companies and which index they are included
#' @examples
#' \dontrun{
#' getIndex(600601)
#' }
#'
#'
getIndex <-function(tickers, indexData) {
if (!(is.data.frame(tickers)|is.numeric(tickers)|is.character(tickers))) warning('Your input better be a data.frame...')
n <- 1
for (i in tickers[[1]]) {
####################### assign to indexArray
indexArray <- rep(0, (length(unique(indexData$index)) + 1))
names(indexArray) <-  c('ticker', as.character(unique(indexData$index)))
subData <- with(indexData, {
indexData[ticker == i]
})
indexArray[as.character(subData$index)] <- 1
indexArray[1] <- i
#######################
if (n == 1) {
res <- indexArray
} else {
# since indexArray is not a dataframe, use rbind instead of rbindlist
res <- rbind(res, indexArray)
}
message(n)
n <- n + 1
}
rownames(res) <- NULL
return(res)
}
getIndexData <- function(){
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
indexData <- getIndexConstnt(indexPool)
return(indexData)
}
getIndex('002202', indexData)
getIndex('00902', indexData)
getIndex('00991', indexData)
getIndex('600188', indexData)
getIndex('601898', indexData)
getIndex('601088', indexData)
getIndex('01088', indexData)
getIndex('900948', indexData)
getIndex('601717', indexData)
a <- read.table('clipboard', colClasses = 'character')
a
b <- getTickers(a)
write.table(b, file, fileEncoding = 'UTF-8', sep = ',', row.names = F)
a
a <- read.table('clipboard', colClasses = 'character')
a
as.character(a)
is.numeric(a)
is.factor(a)
a
c <- getIndex(a, indexData)
c
write.table(c, file, fileEncoding = 'UTF-8', sep = ',', row.names = F)
a <- read.table('clipboard', colClasses = 'character')
a
b <- getTickers(a)
write.table(b, file, fileEncoding = 'UTF-8', sep = ',', row.names = F)
a <- read.table('clipboard', colClasses = 'character')
a
c <- getIndex(a, indexData)
write.table(c, file, fileEncoding = 'UTF-8', sep = ',', row.names = F)
devtools::check()
install.packages('V8')
devtools::check()
devtools::document()
devtools::document()
devtools::document()
devtools::check()
getIndex('02238', indexData)
getIndex('601633', indexData)
getIndex('01211', indexData)
