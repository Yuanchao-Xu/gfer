{
    "collab_server" : "",
    "contents" : "\n#' get a company's market cap, data comes from NetEase\n#'\n#' @param ticker ticker/sympol of a company\n#' @param date1 starting date, in the following format \"20160101\", means Jan 1st of 2016\n#' @param date2 ending date, in the following format \"20160101\", if you only want one day's data, just set starting date and ending date the same day\n#' @return A data table with companies total capitalization and market capitalization\n#' @importFrom utils read.csv\n\ngetMktCap_unit <- function(ticker, date1, date2) {\n\n\n  url1 <- 'http://quotes.money.163.com/service/chddata.html?'\n  url2 <- paste('code=', '0', ticker[[1]], sep = '')\n  url3 <- paste('&start=', date1, '&end=', date2, sep = '')\n  url4 <- '&fields=TCAP;MCAP'\n\n  url <- paste(url1, url2, url3, url4, sep = '')\n\n  res <- read.csv(url)\n  if (nrow(res) == 0) {\n    newRes <- data.frame('no_data', as.character(ticker), 'no_data', 'no_data', 'no_data')\n    names(newRes) <- names(res)\n    res <- newRes\n  }\n  return(res)\n}\n\n\n\n\n#' get a company's market cap, data comes from NetEase\n#'\n#' @param tickers ticker/sympol of a company\n#' @param date1 starting date, in the following format \"20160101\", means Jan 1st of 2016\n#' @param date2 ending date, in the following format \"20160101\", if you only want one day's data, just set starting date and ending date the same day\n#' @return A data table with companies total capitalization and market capitalization\n#' @examples\n#' \\dontrun{\n#' getMktCap(600601, '20160101', '20160102')\n#' }\n#'\n#'\ngetMktCap <- function(tickers, date1, date2) {\n  tickers <- tickers[[1]]\n  if (length(tickers) == 1) {\n    res <- getMktCap_unit(tickers, date1, date2)\n  } else if (length(tickers) > 1) {\n\n    # if the result comes from getTickers, it's factor, need to be converted\n    # if (is.factor(tickers) == TRUE) {\n    #   tickers <- as.character(levels(tickers))[tickers]\n    # }\n    #\n\n    for (i in 1:length(tickers)) {\n      res1 <- getMktCap_unit(tickers[i], date1, date2)\n      if (i == 1) {\n        res <- res1\n      } else {\n        res <- rbindlist(list(res, res1))\n      }\n      message(i)\n    }\n\n  } else {\n    break('Please input a column of tickers, column, not row')\n  }\n  return(res)\n}\n",
    "created" : 1489400332541.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2978427028",
    "id" : "42E8D61F",
    "lastKnownWriteTime" : 1489400372,
    "last_content_update" : 1489400372535,
    "path" : "~/GitHub/gfer/R/getMktCap.R",
    "project_path" : "R/getMktCap.R",
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}