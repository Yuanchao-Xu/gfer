indexArray <- rep(0, length(indexPool$index))
names(indexArray) <- indexPool$index
subData <- data[ticker == tickers]
indexArray[as.character(subData$index)] <- 1
#######################
res <- indexArray
} else {
for (i in 1:nrow(tickers)) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
indexArray[1] <- tickers[i]
names(indexArray) <- indexPool$index
subData <- data[ticker == tickers[i ,]]
indexArray[as.character(subData$index)] <- 1
#######################
if (i == 1) {
res <- indexArray
} else {
res <- rbindlist(list(res, indexArray))
}
}
}
return(res)
}
getIndex(tickers = )
debug(getIndex)
getIndex(tickers)
indexArray
indexArray
getIndex <-function(tickers) {
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
data <- getIndexConstnt(indexPool)
#indexTable <- data.table(tickers)
#emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))
#indexTable[, c(as.character(indexPool$index)) := emptyCols]
if (is.null(nrow(tickers))) {
####################### assign to indexArray
indexArray <- rep(0, length(indexPool$index))
names(indexArray) <- indexPool$index
subData <- data[ticker == tickers]
indexArray[as.character(subData$index)] <- 1
#######################
res <- indexArray
} else {
for (i in 1:nrow(tickers)) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
indexArray[1] <- tickers[i,]
names(indexArray) <- indexPool$index
subData <- data[ticker == tickers[i,]]
indexArray[as.character(subData$index)] <- 1
#######################
if (i == 1) {
res <- indexArray
} else {
res <- rbindlist(list(res, indexArray))
}
}
}
return(res)
}
debug(getIndex)
getIndex(tickers)
indexArray
indexArray
subData
c(tickers[i,], indexPool$index)
indexPool$index
c(tickers[i,], as.character(indexPool$index))
names(indexArray) <-  c(tickers[i,], as.character(indexPool$index))
subData <- data[ticker == tickers[i,]]
names(indexArray) <-  c('ticker', as.character(indexPool$index))
indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
indexArray
getIndex <-function(tickers) {
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
data <- getIndexConstnt(indexPool)
#indexTable <- data.table(tickers)
#emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))
#indexTable[, c(as.character(indexPool$index)) := emptyCols]
for (i in tickers) {
n <- 1
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
subData <- data[ticker == tickers[i,]]
indexArray[as.character(subData$index)] <- 1
indexArray$name <- tickers[i,]
#######################
if (i == 1) {
res <- indexArray
} else {
res <- rbindlist(list(res, indexArray))
}
n <- n + 1
}
return(res)
}
debug(getIndex)
getIndex(tickers)
indexArray
tickers
tickers[1,]
data[ticker == tickers[i,]]
data
i <- 2
data[ticker == tickers[i,]]
tickers[,2]
tickers[2,]
data[ticker == '600022']
getIndex(tickers)
data[ticker == tickers[i,]]
data[ticker == 600011]
tickers[2]
tickers[2,]
tickers[i,]
i
getIndex <-function(tickers) {
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
data <- getIndexConstnt(indexPool)
#indexTable <- data.table(tickers)
#emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))
#indexTable[, c(as.character(indexPool$index)) := emptyCols]
n <- 1
for (i in tickers) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
subData <- data[ticker == i]
indexArray[as.character(subData$index)] <- 1
indexArray$name <- i
#######################
if (n == 1) {
res <- indexArray
} else {
res <- rbindlist(list(res, indexArray))
n <- n + 1
}
}
return(res)
}
debug(getIndex)
getIndex(tickers)
getIndex(tickers)
i
tickers
as.character(tickersï¼‰
as.character(tickers)
as.character(tickers)Q
q
getIndex <-function(tickers) {
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
data <- getIndexConstnt(indexPool)
#indexTable <- data.table(tickers)
#emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))
#indexTable[, c(as.character(indexPool$index)) := emptyCols]
n <- 1
for (i in as.character(tickers)) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
subData <- data[ticker == i]
indexArray[as.character(subData$index)] <- 1
indexArray$name <- i
#######################
if (n == 1) {
res <- indexArray
} else {
res <- rbindlist(list(res, indexArray))
n <- n + 1
}
}
return(res)
}
debug(getIndex)
getIndex(tickers)
i
tickers[[i]]
tickers[[1]]
length(tickers)
str(tickers)
is.data.frame(tickers)
#'
getIndex <-function(tickers) {
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
data <- getIndexConstnt(indexPool)
#indexTable <- data.table(tickers)
#emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))
#indexTable[, c(as.character(indexPool$index)) := emptyCols]
if (!is.data.frame(tickers)) warning('Your input better be a data.frame...')
n <- 1
for (i in tickers[[1]]) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
subData <- data[ticker == i]
indexArray[as.character(subData$index)] <- 1
indexArray$name <- i
#######################
if (n == 1) {
res <- indexArray
} else {
res <- rbindlist(list(res, indexArray))
n <- n + 1
}
}
return(res)
}
debug(getIndex)
getIndex(tickers)
!is.data.frame(tickers)
i
subData
indexArray
indexArrayQ
getIndex <-function(tickers) {
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
data <- getIndexConstnt(indexPool)
#indexTable <- data.table(tickers)
#emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))
#indexTable[, c(as.character(indexPool$index)) := emptyCols]
if (!is.data.frame(tickers)) warning('Your input better be a data.frame...')
n <- 1
for (i in tickers[[1]]) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
subData <- data[ticker == i]
indexArray[as.character(subData$index)] <- 1
indexArray$ticker <- i
#######################
if (n == 1) {
res <- indexArray
} else {
res <- rbindlist(list(res, indexArray))
n <- n + 1
}
}
return(res)
}
debug(getIndex)
getIndex(tickers)
indexArray
indexArray
str(indexArray)
#'
getIndex <-function(tickers) {
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
data <- getIndexConstnt(indexPool)
#indexTable <- data.table(tickers)
#emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))
#indexTable[, c(as.character(indexPool$index)) := emptyCols]
if (!is.data.frame(tickers)) warning('Your input better be a data.frame...')
n <- 1
for (i in tickers[[1]]) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
subData <- data[ticker == i]
indexArray[as.character(subData$index)] <- 1
indexArray[, 1] <- i
#######################
if (n == 1) {
res <- indexArray
} else {
res <- rbindlist(list(res, indexArray))
n <- n + 1
}
}
return(res)
}
debug(getIndex)
getIndex(tickers)
#'
getIndex <-function(tickers) {
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
data <- getIndexConstnt(indexPool)
#indexTable <- data.table(tickers)
#emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))
#indexTable[, c(as.character(indexPool$index)) := emptyCols]
if (!is.data.frame(tickers)) warning('Your input better be a data.frame...')
n <- 1
for (i in tickers[[1]]) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
subData <- data[ticker == i]
indexArray[as.character(subData$index)] <- 1
indexArray[1] <- i
#######################
if (n == 1) {
res <- indexArray
} else {
res <- rbindlist(list(res, indexArray))
n <- n + 1
}
}
return(res)
}
debug(getIndex)
getIndex(tickers)
indexArray
getIndex <-function(tickers) {
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
data <- getIndexConstnt(indexPool)
#indexTable <- data.table(tickers)
#emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))
#indexTable[, c(as.character(indexPool$index)) := emptyCols]
if (!is.data.frame(tickers)) warning('Your input better be a data.frame...')
n <- 1
for (i in tickers[[1]]) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
subData <- data[ticker == i]
indexArray[as.character(subData$index)] <- 1
indexArray[1] <- i
#######################
if (n == 1) {
res <- indexArray
} else {
res <- rbindlist(list(res, indexArray))
}
n <- n + 1
}
return(res)
}
debug(getIndex)
getIndex(tickers)
getIndex <-function(tickers) {
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
data <- getIndexConstnt(indexPool)
#indexTable <- data.table(tickers)
#emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))
#indexTable[, c(as.character(indexPool$index)) := emptyCols]
if (!is.data.frame(tickers)) warning('Your input better be a data.frame...')
n <- 1
for (i in tickers[[1]]) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
subData <- data[ticker == i]
indexArray[as.character(subData$index)] <- 1
indexArray[1] <- i
#######################
if (n == 1) {
res <- indexArray
} else {
# since indexArray is not a dataframe, use rbind instead of rbindlist
res <- rbind(res, indexArray)
}
n <- n + 1
}
return(res)
}
debug(getIndex)
getIndex(tickers)
res
res
?rbind
getIndex(600601)
dim(i)
dim(1)
is.numeric(tickers)
is.numeric(600001)
getIndex <-function(tickers) {
#creat an index pool
indexPool <- data.frame(index = c('CSI_100', 'SSE_50', 'CSI_300', 'SSE_Central_SOEs_50',
'HSI', 'HSCEI'),
url = c('http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000903.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000016.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000300.phtml',
'http://vip.stock.finance.sina.com.cn/corp/go.php/vII_NewestComponent/indexid/000042.phtml',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI',
'https://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=CEI'
)
)
data <- getIndexConstnt(indexPool)
#indexTable <- data.table(tickers)
#emptyCols <- data.frame(matrix(0, nrow = nrow(tickers), ncol =nrow(indexPool)))
#indexTable[, c(as.character(indexPool$index)) := emptyCols]
if (!(is.data.frame(tickers)|is.numeric(tickers)|is.character(tickers))) warning('Your input better be a data.frame...')
n <- 1
for (i in tickers[[1]]) {
####################### assign to indexArray
indexArray <- rep(0, (length(indexPool$index) + 1))
names(indexArray) <-  c('ticker', as.character(indexPool$index))
subData <- data[ticker == i]
indexArray[as.character(subData$index)] <- 1
indexArray[1] <- i
#######################
if (n == 1) {
res <- indexArray
} else {
# since indexArray is not a dataframe, use rbind instead of rbindlist
res <- rbind(res, indexArray, row.names = FALSE)
}
n <- n + 1
}
return(res)
}
getIndex(600601)
devtools::document()
getMktCap(600601, '20160101', '20160102')
getMktCap(600601, 20160101, 20160102)
devtools::document()
devtools::document()
devtools::document()
devtools::check()
devtools::check()
